<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØºØ§Ù…Ø±Ø© Ø¹Ù„ÙˆÙ… Ø§Ù„ÙƒÙˆÙ† - Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #0b0d17; color: #e2e8f0; overflow-x: hidden; margin: 0; }
        .space-bg { background: radial-gradient(circle at 50% 50%, #1b2735 0%, #090a0f 100%); min-height: 100vh; }
        
        .card { 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 2rem; 
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #0b0d17;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out;
        }

        .nav-step {
            padding: 0.5rem 1rem;
            border-radius: 999px;
            font-size: 0.85rem;
            border: 1px solid rgba(255,255,255,0.2);
            opacity: 0.5;
            white-space: nowrap;
        }
        .nav-step.active { 
            opacity: 1; 
            background: rgba(59, 130, 246, 0.2); 
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .btn-choice { 
            background: rgba(255, 255, 255, 0.05); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            transition: all 0.2s; 
            width: 100%; 
            text-align: right; 
            padding: 1.2rem; 
            border-radius: 1rem; 
            margin-bottom: 0.8rem; 
        }
        .btn-choice.selected { border-color: #3b82f6 !important; background: rgba(59, 130, 246, 0.3) !important; }

        .star-option {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid transparent;
            position: relative;
        }
        .star-blue { background: #3b82f6; box-shadow: 0 0 25px rgba(59, 130, 246, 0.6); }
        .star-yellow { background: #fbbf24; box-shadow: 0 0 25px rgba(251, 191, 36, 0.6); }
        .star-red { background: #ef4444; box-shadow: 0 0 25px rgba(239, 68, 68, 0.6); }
        .star-option.selected { border-color: white; transform: scale(1.1); box-shadow: 0 0 45px white; }

        .hidden { display: none; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .rocket-anim { animation: float 3s ease-in-out infinite; }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 999px;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body class="space-bg">

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· -->
    <div id="splash-screen">
        <div class="rocket-anim text-7xl mb-6">ğŸš€</div>
        <h1 class="text-4xl font-bold text-white mb-4">Ù…ØºØ§Ù…Ø±Ø© Ø¹Ù„ÙˆÙ… Ø§Ù„ÙƒÙˆÙ†</h1>
        <p class="text-blue-300 mb-8">Ø§Ø³ØªØ¹Ø¯ÙŠ Ù„Ù„Ø±Ø­Ù„Ø© ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ Ø³Ø¨ÙŠØ³ÙŠØ§..</p>
        <button onclick="startApp()" class="bg-blue-600 hover:bg-blue-500 text-white px-12 py-4 rounded-full font-bold text-xl transition-all transform hover:scale-105 shadow-xl">
            Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø¢Ù†
        </button>
    </div>

    <div id="toast">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©! ğŸš€</div>

    <div id="main-content" class="max-w-4xl mx-auto px-4 py-8 hidden">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-3xl font-bold text-white mb-6">Ù…ØºØ§Ù…Ø±Ø© Ø¹Ù„ÙˆÙ… Ø§Ù„ÙƒÙˆÙ†</h1>
            
            <div class="flex flex-wrap justify-center gap-2 mb-6">
                <div id="step-1" class="nav-step active">1. Ø§Ù„Ø¶ÙˆØ¡</div>
                <div id="step-2" class="nav-step">2. Ø§Ù„Ù…Ù†Ø§Ø¸ÙŠØ±</div>
                <div id="step-3" class="nav-step">3. Ø§Ù„Ù†Ø¬ÙˆÙ…</div>
                <div id="step-4" class="nav-step">4. Ø§Ù„Ø­ÙŠØ§Ø©</div>
                <div id="step-5" class="nav-step">5. Ø§Ù„Ù…Ø¬Ø±Ø§Øª</div>
            </div>

            <div class="w-full bg-gray-800 h-2 rounded-full max-w-md mx-auto overflow-hidden">
                <div id="progress-bar" class="bg-blue-500 h-full transition-all duration-500" style="width: 5%"></div>
            </div>
        </div>

        <!-- Quiz Area -->
        <div id="quiz-container" class="card">
            <div id="question-area"></div>
            <div class="mt-8 flex justify-center">
                <button id="next-btn" onclick="submitAnswer()" class="bg-blue-600 px-14 py-4 rounded-2xl font-bold text-white shadow-lg hidden">
                    ØªØ£ÙƒÙŠØ¯ ÙˆØ¥ÙƒÙ…Ø§Ù„ â¬…ï¸
                </button>
            </div>
        </div>

        <!-- Mastery -->
        <div id="mastery-container" class="card hidden border-yellow-500/30 bg-yellow-500/5">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-yellow-400">Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¥ØªÙ‚Ø§Ù† ğŸ”</h2>
                <p class="text-gray-300">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù„ØªØ«Ø¨ÙŠØª</p>
            </div>
            <div id="mastery-area"></div>
            <button onclick="submitMastery()" class="w-full mt-8 bg-yellow-600 py-4 rounded-2xl font-bold text-white">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØªÙ‚Ø§Ù†</button>
        </div>

        <!-- Result -->
        <div id="result-screen" class="card hidden text-center">
            <div class="text-6xl mb-4">ğŸ†</div>
            <h2 class="text-3xl font-bold text-green-400 mb-2">Ø±Ø§Ø¦Ø¹Ø©! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…ØªÙ Ø§Ù„Ù…Ù‡Ù…Ø©</h2>
            <div class="text-5xl font-bold my-8"><span id="final-score">0</span> / 20</div>
            <div class="flex flex-col gap-3">
                <button onclick="shareResult()" class="bg-blue-600 text-white py-4 rounded-2xl font-bold">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
                <button onclick="location.reload()" class="bg-white/10 text-white py-4 rounded-2xl">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ”„</button>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            { id: 1, step: 1, type: 'choice', q: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ø£Ù‚ØµØ± Ø·ÙˆÙ„ Ù…ÙˆØ¬ÙŠ ÙˆØ£Ø¹Ù„Ù‰ Ø·Ø§Ù‚Ø©ØŸ", options: ["Ù…ÙˆØ¬Ø§Øª Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ", "Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø±Ø¦ÙŠ", "Ø£Ø´Ø¹Ø© Ø¬Ø§Ù…Ø§", "Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙŠÙ"], correct: 2 },
            { id: 2, step: 1, type: 'choice', q: "ØªØªÙƒÙˆÙ† Ø§Ù„Ù…ÙˆØ¬Ø§Øª Ø§Ù„ÙƒÙ‡Ø±ÙˆÙ…ØºÙ†Ø§Ø·ÙŠØ³ÙŠØ© Ù…Ù† Ù…Ø¬Ø§Ù„ÙŠÙ† Ù‡Ù…Ø§:", options: ["ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ ÙˆÙ…ØºÙ†Ø§Ø·ÙŠØ³ÙŠ", "ØµÙˆØªÙŠ ÙˆØ¶ÙˆØ¦ÙŠ", "ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ ÙˆØ­Ø±ÙƒÙŠ", "Ø­Ø±Ø§Ø±ÙŠ ÙˆÙ†ÙˆÙˆÙŠ"], correct: 0 },
            { id: 3, step: 1, type: 'boolean', q: "Ø§Ù„Ù…ÙˆØ¬Ø§Øª Ø§Ù„ÙƒÙ‡Ø±ÙˆÙ…ØºÙ†Ø§Ø·ÙŠØ³ÙŠØ© Ù„Ø§ ØªØ­ØªØ§Ø¬ Ù„ÙˆØ³Ø· Ù…Ø§Ø¯ÙŠ ÙˆØªÙ†ØªÙ‚Ù„ ÙÙŠ Ø§Ù„ÙØ±Ø§Øº.", options: ["ØµØ­", "Ø®Ø·Ø£"], correct: 0 },
            { id: 4, step: 1, type: 'choice', q: "Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„ØªÙŠ Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ø±Ø¤ÙŠØ© ÙˆØªØªØ­Ù„Ù„ Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‚ÙˆØ³ Ù‡ÙŠ:", options: ["ÙÙˆÙ‚ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠØ©", "Ø§Ù„Ø³ÙŠÙ†ÙŠØ©", "Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø±Ø¦ÙŠ", "ØªØ­Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡"], correct: 2 },
            { id: 5, step: 2, type: 'choice', q: "Ù…Ù†Ø¸Ø§Ø± Ù‡Ø§Ø¨Ù„ Ø§Ù„ÙØ¶Ø§Ø¦ÙŠ ÙŠØªÙ…ÙŠØ² Ø¨Ø£Ù†Ù‡:", options: ["Ø±Ø§Ø¯ÙŠÙˆÙŠ", "Ø¶ÙˆØ¦ÙŠ ÙŠØ¹Ù…Ù„ Ø®Ø§Ø±Ø¬ Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠ", "Ø¹Ø§ÙƒØ³ ÙŠØ³ØªØ®Ø¯Ù… Ø¹Ø¯Ø³Ø§Øª"], correct: 1 },
            { id: 6, step: 2, type: 'boolean', q: "Ø§Ù„Ù…Ù†Ø¸Ø§Ø± Ø§Ù„ÙƒØ§Ø³Ø± ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±Ø§ÙŠØ§ Ø§Ù„Ù…Ù‚Ø¹Ø±Ø© Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¶ÙˆØ¡.", options: ["ØµØ­", "Ø®Ø·Ø£ (ÙŠØ³ØªØ®Ø¯Ù… Ø¹Ø¯Ø³Ø§Øª)"], correct: 1 },
            { id: 7, step: 2, type: 'choice', q: "Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø¸ÙŠØ± ÙŠØ¹Ù…Ù„ 24 Ø³Ø§Ø¹Ø© ÙˆÙ„Ø§ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„Ø¬ÙˆØŸ", options: ["Ø§Ù„Ø¹Ø§ÙƒØ³", "Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆÙŠ", "Ø§Ù„ÙƒØ§Ø³Ø±"], correct: 1 },
            { id: 8, step: 2, type: 'choice', q: "Ø§Ù„Ù…Ù†Ø¸Ø§Ø± Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø¹Ø¯Ø³Ø© Ù…Ø­Ø¯Ø¨Ø© ÙƒØ¨ÙŠØ±Ø© ØªØ³Ù…Ù‰ 'Ø§Ù„Ø´ÙŠØ¦ÙŠØ©' Ù‡Ùˆ:", options: ["Ø§Ù„Ù…Ù†Ø¸Ø§Ø± Ø§Ù„ÙƒØ§Ø³Ø±", "Ø§Ù„Ù…Ù†Ø¸Ø§Ø± Ø§Ù„Ø¹Ø§ÙƒØ³", "Ø§Ù„Ù…Ù†Ø¸Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆÙŠ"], correct: 0 },
            { id: 9, step: 3, type: 'choice', q: "ØªØ¨Ø¯Ùˆ Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆÙƒØ£Ù†Ù‡Ø§ ØªØªØ­Ø±Ùƒ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ Ø¨Ø³Ø¨Ø¨:", options: ["Ø­Ø±ÙƒØªÙ‡Ø§ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©", "Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø£Ø±Ø¶ Ø­ÙˆÙ„ Ù…Ø­ÙˆØ±Ù‡Ø§", "ØªØºÙŠØ± Ø§Ù„Ù…Ø³Ø§ÙØ©"], correct: 1 },
            { id: 10, step: 3, type: 'star', q: "Ù…ÙŠØ²Ø§Ù† Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù†Ø¬ÙˆÙ…: Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¬Ù… **Ø§Ù„Ø£ÙƒØ«Ø± Ø­Ø±Ø§Ø±Ø©** ÙÙŠ Ø§Ù„ÙƒÙˆÙ†:", options: ["Ø£Ø²Ø±Ù‚", "Ø£ØµÙØ±", "Ø£Ø­Ù…Ø±"], colors: ['blue', 'yellow', 'red'], correct: 0 },
            { id: 11, step: 3, type: 'boolean', q: "Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ø£Ø­Ù…Ø± Ù‡Ùˆ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ø£Ø¨Ø±Ø¯ ÙˆØ§Ù„Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø©.", options: ["ØµØ­", "Ø®Ø·Ø£"], correct: 0 },
            { id: 12, step: 3, type: 'choice', q: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù†Ø¬Ù…ÙŠØ© Ø§Ù„Ù‚Ø·Ø¨ÙŠØ© Ù‡ÙŠ Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø±:", options: ["ÙÙŠ Ø§Ù„ØµÙŠÙ ÙÙ‚Ø·", "Ø·ÙˆØ§Ù„ Ø§Ù„Ø¹Ø§Ù… ÙÙˆÙ‚ Ø§Ù„Ù‚Ø·Ø¨ÙŠÙ†", "ÙƒÙ„ 10 Ø³Ù†ÙˆØ§Øª"], correct: 1 },
            { id: 13, step: 4, type: 'order', q: "Ø±ØªØ¨ÙŠ Ù…Ø±Ø§Ø­Ù„ Ø­ÙŠØ§Ø© (Ù†Ø¬Ù… ÙÙˆÙ‚ Ø¹Ù…Ù„Ø§Ù‚):", items: ["Ø³Ø¯ÙŠÙ…", "Ù†Ø¬Ù… Ø£ÙˆÙ„ÙŠ", "Ù†Ø¬Ù… ÙÙˆÙ‚ Ø¹Ù…Ù„Ø§Ù‚", "Ø§Ù†ÙØ¬Ø§Ø± Ù…Ø³ØªØ¹Ø± Ø£Ø¹Ø¸Ù…", "Ø«Ù‚Ø¨ Ø£Ø³ÙˆØ¯"], correctOrder: [0,1,2,3,4] },
            { id: 14, step: 4, type: 'choice', q: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„ÙØ¨ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¶Ø®Ù…Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ (Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø´Ù…Ø³ Ø¨Ù€ 3 Ù…Ø±Ø§Øª) ÙŠØµØ¨Ø­:", options: ["Ù‚Ø²Ù…Ø§Ù‹ Ø£Ø¨ÙŠØ¶", "Ù†Ø¬Ù…Ø§Ù‹ Ù†ÙŠÙˆØªØ±ÙˆÙ†ÙŠØ§Ù‹", "Ø«Ù‚Ø¨Ø§Ù‹ Ø£Ø³ÙˆØ¯"], correct: 2 },
            { id: 15, step: 4, type: 'choice', q: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙŠ ØªÙ‚Ø¶ÙŠ ÙÙŠÙ‡Ø§ Ø§Ù„Ø´Ù…Ø³ Ù…Ø¹Ø¸Ù… Ø­ÙŠØ§ØªÙ‡Ø§ØŸ", options: ["Ø§Ù„Ø³Ø¯ÙŠÙ…", "Ø§Ù„ØªØªØ§Ø¨Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±"], correct: 1 },
            { id: 16, step: 4, type: 'boolean', q: "ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ù…ØªÙˆØ³Ø· (ÙƒØ§Ù„Ø´Ù…Ø³) ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙ‚Ø²Ù… Ø£Ø³ÙˆØ¯.", options: ["ØµØ­", "Ø®Ø·Ø£"], correct: 0 },
            { id: 17, step: 5, type: 'choice', q: "Ù…Ø§ Ù†ÙˆØ¹ Ù…Ø¬Ø±Ø© Ø¯Ø±Ø¨ Ø§Ù„ØªØ¨Ø§Ù†Ø© Ø§Ù„ØªÙŠ Ù†Ù†ØªÙ…ÙŠ Ø¥Ù„ÙŠÙ‡Ø§ØŸ", options: ["Ø¥Ù‡Ù„ÙŠÙ„Ø¬ÙŠØ©", "ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©", "Ø­Ù„Ø²ÙˆÙ†ÙŠØ©"], correct: 2 },
            { id: 18, step: 5, type: 'choice', q: "Ø§Ù„Ù…Ø¬Ø±Ø© Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø´ÙƒÙ„ ÙƒØ±Ø© ÙˆØªØ®Ù„Ùˆ Ù…Ù† Ø§Ù„ØºØ¨Ø§Ø±:", options: ["Ø¥Ù‡Ù„ÙŠÙ„Ø¬ÙŠØ©", "Ø­Ù„Ø²ÙˆÙ†ÙŠØ©", "ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©"], correct: 0 },
            { id: 19, step: 5, type: 'choice', q: "ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¶ÙˆØ¦ÙŠØ© Ù„Ù‚ÙŠØ§Ø³:", options: ["Ø¹Ù…Ø± Ø§Ù„Ù†Ø¬ÙˆÙ…", "Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©", "Ø³Ø±Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†"], correct: 1 },
            { id: 20, step: 5, type: 'boolean', q: "Ø§Ù„ÙƒÙˆÙ† ÙŠØªÙˆØ³Ø¹ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø¬Ø±Ø§Øª ØªØ¨ØªØ¹Ø¯ Ø¹Ù† Ø¨Ø¹Ø¶Ù‡Ø§.", options: ["ØµØ­", "Ø®Ø·Ø£"], correct: 0 }
        ];

        let currentIdx = 0, score = 0, missedQuestions = [], userSelection = null, isMasteryMode = false;

        function startApp() {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => {
                splash.classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                renderQuestion();
            }, 800);
        }

        function renderQuestion() {
            isMasteryMode = false;
            const q = allQuestions[currentIdx];
            updateVisuals(q.step);
            
            let html = `<h2 class="text-blue-400 text-sm font-bold mb-2">Ø§Ù„Ù…Ù‡Ù…Ø© ${currentIdx + 1}:</h2>`;
            html += `<h3 class="text-2xl font-bold mb-8 leading-relaxed">${q.q}</h3>`;
            
            if (q.type === 'choice' || q.type === 'boolean') {
                html += `<div class="grid gap-3">`;
                q.options.forEach((opt, i) => html += `<button onclick="selectOption(${i}, 'opt')" class="btn-choice opt-btn" id="opt-${i}">${opt}</button>`);
                html += `</div>`;
            } else if (q.type === 'star') {
                html += `<div class="flex justify-around items-center py-10">`;
                q.colors.forEach((col, i) => html += `<div class="text-center"><div onclick="selectOption(${i}, 'opt')" id="opt-${i}" class="star-option star-${col} mb-3 mx-auto"></div><span class="text-sm text-gray-400">${q.options[i]}</span></div>`);
                html += `</div>`;
            } else if (q.type === 'order') {
                html += `<div id="drag-container" class="space-y-2">`;
                [...q.items].sort(() => Math.random() - 0.5).forEach((item, i) => html += `<div draggable="true" ondragstart="drag(event)" ondragover="allowDrop(event)" ondrop="drop(event)" class="drag-item" id="drag-${i}">${item}</div>`);
                html += `</div>`;
                userSelection = "order-active";
            }
            document.getElementById('question-area').innerHTML = html;
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function updateVisuals(step) {
            document.querySelectorAll('.nav-step').forEach((s, i) => s.classList.toggle('active', (i + 1) === step));
            document.getElementById('progress-bar').style.width = ((currentIdx / 20) * 100) + "%";
        }

        function selectOption(idx, prefix) {
            userSelection = idx;
            const area = document.getElementById(isMasteryMode ? 'mastery-area' : 'question-area');
            area.querySelectorAll('.opt-btn, .star-option').forEach(el => el.classList.remove('selected'));
            document.getElementById(`${prefix}-${idx}`).classList.add('selected');
        }

        function submitAnswer() {
            if (userSelection === null) return;
            const q = allQuestions[currentIdx];
            let correct = (q.type === 'order') ? 
                JSON.stringify([...document.getElementById('drag-container').children].map(el => el.innerText.trim())) === JSON.stringify(q.items) :
                (userSelection === q.correct);

            if (correct) score++; else missedQuestions.push(q);
            currentIdx++; userSelection = null;
            if (currentIdx < allQuestions.length) renderQuestion(); else startMastery();
        }

        function startMastery() {
            if (missedQuestions.length === 0) { showFinal(); return; }
            isMasteryMode = true;
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('mastery-container').classList.remove('hidden');
            renderMastery();
        }

        function renderMastery() {
            const q = missedQuestions[0];
            let html = `<h3 class="text-xl font-bold mb-6">${q.q}</h3>`;
            if (q.type === 'choice' || q.type === 'boolean') {
                html += `<div class="grid gap-2">`;
                q.options.forEach((opt, i) => html += `<button onclick="selectOption(${i}, 'm-opt')" class="btn-choice opt-btn" id="m-opt-${i}">${opt}</button>`);
                html += `</div>`;
            } else if (q.type === 'star') {
                html += `<div class="flex justify-around items-center py-6">`;
                q.colors.forEach((col, i) => html += `<div class="text-center"><div onclick="selectOption(${i}, 'm-opt')" id="m-opt-${i}" class="star-option star-${col} mb-2 mx-auto"></div><span class="text-sm text-gray-400">${q.options[i]}</span></div>`);
                html += `</div>`;
            } else {
                html += `<div id="drag-container" class="space-y-2">`;
                [...q.items].sort(() => Math.random() - 0.5).forEach((item, i) => html += `<div draggable="true" ondragstart="drag(event)" ondragover="allowDrop(event)" ondrop="drop(event)" class="drag-item" id="m-drag-${i}">${item}</div>`);
                html += `</div>`;
                userSelection = "order-active";
            }
            document.getElementById('mastery-area').innerHTML = html;
        }

        function submitMastery() {
            if (userSelection === null) return;
            const q = missedQuestions[0];
            let correct = (q.type === 'order') ? 
                JSON.stringify([...document.getElementById('drag-container').children].map(el => el.innerText.trim())) === JSON.stringify(q.items) :
                (userSelection === q.correct);

            if (correct) { missedQuestions.shift(); userSelection = null; if (missedQuestions.length > 0) renderMastery(); else showFinal(); }
            else { alert("Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!"); }
        }

        function showFinal() {
            document.getElementById('mastery-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
        }

        function shareResult() {
            const text = `ğŸš€ Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ù…ØºØ§Ù…Ø±Ø© Ø¹Ù„ÙˆÙ… Ø§Ù„ÙƒÙˆÙ†! \nâ­ Ù†ØªÙŠØ¬ØªÙŠ: ${score}/20 \nğŸ”— Ø¬Ø±Ø¨ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ: ${window.location.href}`;
            const ta = document.createElement("textarea"); ta.value = text; document.body.appendChild(ta); ta.select();
            document.execCommand('copy'); document.body.removeChild(ta);
            const t = document.getElementById('toast'); t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000);
        }

        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev) {
            ev.preventDefault(); const data = ev.dataTransfer.getData("text");
            const dragged = document.getElementById(data); const target = ev.target.closest('.drag-item');
            if (target && dragged !== target) {
                const rect = target.getBoundingClientRect();
                const next = (ev.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
                target.parentNode.insertBefore(dragged, next ? target.nextSibling : target);
            }
        }
    </script>
</body>
</html>